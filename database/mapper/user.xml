<?xml version="1.0" encoding="UTF-8"?>
<sql id="user">
	
	<!-- 添加用户 --> 
	<insert id="add">
		insert into
		user(username,password,name,dept,mobile,pid,role,status,gmt_create)
		values(
            {{username | q}},
            {{password | q}},
            {{name | q}},
            {{dept | q}},
            {{mobile | q}},
            {{pid | q}},
            {{role | q}},
            {{status | q}},
            {{gmt_create | dateFormat}}
		)
	</insert>
	
	<!-- 查询用户 -->
	<select id="query">
		select 
			*
		from
			view_user t1
		where 1 = 1
			{{if status}}
				and	t1.status = {{status | p}}
			{{/if}}
			{{if name}}
				and	(t1.name like {{name | p}} or t1.username like {{name | p}})
			{{/if}}
			{{if dept}}
				and t1.dept = {{dept}}
			{{/if}}
			{{if sort}}
				order by {{sort}}
			{{/if}}
			{{if offset}}
				limit {{offset}},{{pageSize}}
			{{/if}}
	</select>
	
	<!-- 查询数量 -->
	<select id="count">
		select 
			count(1)
		from
			user t1
		left join
			department t2 on t1.dept = t2.id
		where 1 = 1
			{{if name}}
				and	t1.name like {{name | p}}
			{{/if}}
			{{if dept}}
				and t2.id = {{dept}}
			{{/if}}
	</select>

	<!-- 更新用户信息 -->
	<update id="update">
	    update 
	        user
	    set
	        mobile = {{mobile | q}}
		{{if role}}
			,role = {{role | q}}
		{{/if}}
		{{if pid}}
			,pid = {{pid | q}}
		{{/if}}
		{{if status}}
			,status = {{status | q}}
		{{/if}}
		{{if dept}}
			,dept = {{dept | q}}
		{{/if}}
		{{if password}}
			,password = {{password | q}}
		{{/if}}
		{{if name}}
			,name = {{name | q}}
		{{/if}}
	    where 
	        id = {{id | q}}
	</update>

    <select id="get">
        select
            *
        from
            user
        where
            id = {{id | q}}
    </select>

    <select id="isUnique">
        select
            count(1)
        from
            user
        where
            username = {{username | q}}
        {{if id}}
            id != {{id}}
        {{/if}}
    </select>

    <delete id="delete">
        delete from
            user
        where
            id = {{id | q}}
    </delete>


</sql>