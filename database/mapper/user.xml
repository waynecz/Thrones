<?xml version="1.0" encoding="UTF-8"?>
<sql id="user">
	
	<!-- 添加用户 --> 
	<insert id="add">
		insert into
		user(username,password,name,department_id,role,status,gmt_create)
		values(
            {{username | q}},
            {{password | q}},
            {{name | q}},
            {{department_id | q}},
            {{role | q}},
            {{status | q}},
            {{gmt_create | dateFormat}}
		)
	</insert>

	<!--登陆 -->
	<select id="login">
	    select
	        *
	    from
	        user
	    where
	        username = {{username | q}}
			and
			password = {{password | q}}
	</select>
	<!-- 查询用户 -->
	<select id="pageQuery">
		select 
			*
		from
			view_user t1
		where 1 = 1
			{{if status}}
				and	t1.status = {{status | p}}
			{{/if}}
			{{if name}}
				and	(t1.name like {{name | p}} or t1.username like {{name | p}})
			{{/if}}
			{{if department}}
				and t1.department_id = {{department | q}}
			{{/if}}
			{{if role}}
				and t1.role = {{role | q}}
			{{/if}}
			{{if sort}}
				order by {{sort}}
			{{/if}}
			{{if offset}}
				limit {{offset}},{{pageSize}}
			{{/if}}
	</select>
	
	<!-- 查询数量 -->
	<select id="pageCount">
        select
            count(1)
        from
            view_user t1
        where 1 = 1
            {{if status}}
                and	t1.status = {{status | p}}
            {{/if}}
            {{if name}}
                and	(t1.name like {{name | p}} or t1.username like {{name | p}})
            {{/if}}
            {{if department}}
                and t1.department_id = {{department | q}}
            {{/if}}
            {{if role}}
                and t1.role = {{role | q}}
            {{/if}}
	</select>

	<!-- 更新用户信息 -->
	<update id="update">
	    update 
	        user
	    set
	        mobile = {{mobile | q}}
		{{if role}}
			,role = {{role | q}}
		{{/if}}
		{{if pid}}
			,pid = {{pid | q}}
		{{/if}}
		{{if status}}
			,status = {{status | q}}
		{{/if}}
		{{if dept}}
			,dept = {{dept | q}}
		{{/if}}
		{{if password}}
			,password = {{password | q}}
		{{/if}}
		{{if name}}
			,name = {{name | q}}
		{{/if}}
	    where 
	        id = {{id | q}}
	</update>

    <select id="get">
        select
            *
        from
            user
        where
            id = {{id | q}}
    </select>

    <select id="isUnique">
        select
            count(1)
        from
            user
        where
            username = {{username | q}}
        {{if id}}
            id != {{id}}
        {{/if}}
    </select>

    <delete id="delete">
        delete from
            user
        where
            id = {{id | q}}
    </delete>


</sql>